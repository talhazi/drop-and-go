var z=Object.defineProperty;var J=n=>{throw TypeError(n)};var A=(n,r,e)=>r in n?z(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e;var V=(n,r,e)=>A(n,typeof r!="symbol"?r+"":r,e),O=(n,r,e)=>r.has(n)||J("Cannot "+e);var s=(n,r,e)=>(O(n,r,"read from private field"),e?e.call(n):r.get(n)),f=(n,r,e)=>r.has(n)?J("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,e),d=(n,r,e,t)=>(O(n,r,"write to private field"),t?t.call(n,e):r.set(n,e),e),o=(n,r,e)=>(O(n,r,"access private method"),e);import{y as G,J as H,p as Q,e as W,b as X,M as Z,K as _,O as ee,t as E,P as te}from"./index-Cx5CK9-U.js";import{E as se}from"./vidstack-DDXt6fpN-DtdrIfjf.js";import{resolveYouTubeVideoId as ie}from"./vidstack-Dm1xEU9Q-qchDHvRd.js";const y={Ended:0,Playing:1,Paused:2,Buffering:3,Cued:5};var a,T,k,p,w,m,M,b,i,ae,oe,K,g,B,D,N,j,R,Y,q,F,P,x;class ue extends se{constructor(e,t){super(e);f(this,i);V(this,"$$PROVIDER_TYPE","YOUTUBE");V(this,"scope",G());f(this,a);f(this,T,H(""));f(this,k,-1);f(this,p,null);f(this,w,-1);f(this,m,!1);f(this,M,!1);f(this,b,new Map);V(this,"language","en");V(this,"color","red");V(this,"cookies",!1);d(this,a,t)}get currentSrc(){return s(this,p)}get type(){return"youtube"}get videoId(){return s(this,T).call(this)}preconnect(){Q(this.getOrigin())}setup(){super.setup(),W(o(this,i,K).bind(this)),s(this,a).notify("provider-setup",this)}destroy(){o(this,i,F).call(this);;s(this,b).clear()}async play(){return o(this,i,g).call(this,"playVideo")}async pause(){return o(this,i,g).call(this,"pauseVideo")}setMuted(e){e?o(this,i,g).call(this,"mute"):o(this,i,g).call(this,"unMute")}setCurrentTime(e){e===0&&(e=.001),o(this,i,g).call(this,"seekTo",e),s(this,a).notify("seeking",e)}setVolume(e){o(this,i,g).call(this,"setVolume",e*100)}setPlaybackRate(e){o(this,i,g).call(this,"setPlaybackRate",e)}async loadSource(e){if(!X(e.src)){d(this,p,null),s(this,T).set("");return}const t=ie(e.src);s(this,T).set(t??""),d(this,p,e)}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}buildParams(){const{keyDisabled:e}=s(this,a).$props,{muted:t,playsInline:h,nativeControls:l}=s(this,a).$state,u=l(),c={rel:0,autoplay:0,cc_lang_pref:this.language,cc_load_policy:u?1:void 0,color:this.color,controls:u?1:0,disablekb:!u||e()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:u?1:3,mute:t()?1:0,playsinline:h()?1:0};return s(this,p)&&s(this,p).clipStartTime&&(c.start=Math.floor(s(this,p).clipStartTime)),c}onLoad(){window.setTimeout(()=>this.postMessage({event:"listening"}),100)}onMessage({info:e},t){var c;if(!e)return;const{title:h,intrinsicDuration:l,playbackRate:u}=s(this,a).$state;if(ee(e.videoData)&&e.videoData.title!==h()&&s(this,a).notify("title-change",e.videoData.title,t),E(e.duration)&&e.duration!==l()){if(E(e.videoLoadedFraction)){const v=((c=e.progressState)==null?void 0:c.loaded)??e.videoLoadedFraction*e.duration,S=new _(0,e.duration);o(this,i,j).call(this,v,S,t)}s(this,a).notify("duration-change",e.duration,t)}if(E(e.playbackRate)&&e.playbackRate!==u()&&s(this,a).notify("rate-change",e.playbackRate,t),e.progressState){const{current:v,seekableStart:S,seekableEnd:$,loaded:I,duration:C}=e.progressState;o(this,i,N).call(this,v,t),o(this,i,j).call(this,I,new _(S,$),t),C!==l()&&s(this,a).notify("duration-change",C,t)}if(E(e.volume)&&te(e.muted)&&!s(this,m)){const v={muted:e.muted,volume:e.volume/100};s(this,a).notify("volume-change",v,t)}E(e.playerState)&&e.playerState!==s(this,k)&&o(this,i,q).call(this,e.playerState,t)}}a=new WeakMap,T=new WeakMap,k=new WeakMap,p=new WeakMap,w=new WeakMap,m=new WeakMap,M=new WeakMap,b=new WeakMap,i=new WeakSet,ae=function(e){var t;(t=o(this,i,P).call(this,"playVideo"))==null||t.reject(e)},oe=function(e){var t;(t=o(this,i,P).call(this,"pauseVideo"))==null||t.reject(e)},K=function(){o(this,i,F).call(this);const e=s(this,T).call(this);if(!e){this.src.set("");return}s(this,p)&&s(this,p).clipStartTime&&d(this,M,!0),this.src.set(`${this.getOrigin()}/embed/${e}`),s(this,a).notify("load-start")},g=function(e,t){let h=Z(),l=s(this,b).get(e);return l||s(this,b).set(e,l=[]),l.push(h),this.postMessage({event:"command",func:e,args:t?[t]:void 0}),h.promise},B=function(e){s(this,a).notify("loaded-metadata"),s(this,a).notify("loaded-data"),s(this,p)&&s(this,p).clipStartTime&&(d(this,M,!0),this.postMessage({event:"command",func:"pauseVideo",args:[]}),this.postMessage({event:"command",func:"seekTo",args:[s(this,p).clipStartTime,!0]}),setTimeout(()=>{this.postMessage({event:"command",func:"pauseVideo",args:[]})},100)),s(this,a).delegate.ready(void 0,e)},D=function(e){var t;(t=o(this,i,P).call(this,"pauseVideo"))==null||t.resolve(),s(this,a).notify("pause",void 0,e)},N=function(e,t){const{duration:h,realCurrentTime:l}=s(this,a).$state,u=s(this,k)===y.Ended,c=u?h():e;s(this,a).notify("time-change",c,t),!u&&Math.abs(c-l())>1&&s(this,a).notify("seeking",c,t)},j=function(e,t,h){const l={buffered:new _(0,e),seekable:t};s(this,a).notify("progress",l,h);const{seeking:u,realCurrentTime:c}=s(this,a).$state;u()&&e>c()&&o(this,i,R).call(this,h)},R=function(e){const{paused:t,realCurrentTime:h}=s(this,a).$state;window.clearTimeout(s(this,w)),d(this,w,window.setTimeout(()=>{s(this,a).notify("seeked",h(),e),d(this,w,-1)},t()?100:0))},Y=function(e){const{seeking:t}=s(this,a).$state;t()&&o(this,i,R).call(this,e),s(this,a).notify("pause",void 0,e),s(this,a).notify("end",void 0,e)},q=function(e,t){var C,L,U;const{paused:h,seeking:l}=s(this,a).$state,u=e===y.Playing,c=e===y.Buffering,v=o(this,i,x).call(this,"playVideo"),S=o(this,i,x).call(this,"pauseVideo"),$=h()&&(c||u),I=s(this,a).$state.nativeControls();if(c&&s(this,a).notify("waiting",void 0,t),l()&&u&&o(this,i,R).call(this,t),I){switch(d(this,m,!1),$&&((C=o(this,i,P).call(this,"playVideo"))==null||C.resolve(),s(this,a).notify("play",void 0,t)),e){case y.Cued:o(this,i,B).call(this,t);break;case y.Playing:s(this,a).notify("playing",void 0,t);break;case y.Paused:o(this,i,D).call(this,t);break;case y.Ended:o(this,i,Y).call(this,t);break}d(this,k,e);return}if(s(this,m)&&u){this.pause(),d(this,m,!1),this.setMuted(s(this,a).$state.muted());return}if(e===y.Paused&&S){(L=o(this,i,P).call(this,"pauseVideo"))==null||L.resolve(),s(this,a).notify("pause",void 0,t);return}if(e===y.Paused&&v&&!S&&setTimeout(()=>{this.play()},100),!v&&$){d(this,m,!0),this.setMuted(!0);return}switch($&&((U=o(this,i,P).call(this,"playVideo"))==null||U.resolve(),s(this,a).notify("play",void 0,t)),e){case y.Cued:o(this,i,B).call(this,t);break;case y.Playing:s(this,a).notify("playing",void 0,t);break;case y.Paused:o(this,i,D).call(this,t);break;case y.Ended:o(this,i,Y).call(this,t);break}d(this,k,e)},F=function(){d(this,k,-1),d(this,w,-1),d(this,m,!1),d(this,M,!1)},P=function(e){var t;return(t=s(this,b).get(e))==null?void 0:t.shift()},x=function(e){var t;return!!((t=s(this,b).get(e))!=null&&t.length)};export{ue as YouTubeProvider};
