function xPanoramaViewer(){window.xPanoramaObservers||(window.xPanoramaObservers=[]),window.xPanoramaObserverInstances||(window.xPanoramaObserverInstances={});let e=function(e,t){e.style.backgroundImage="none",e.style.width="auto",e.style.height="auto",t.text&&e.classList.add("pnlm-tooltip"),e.setAttribute("role","region"),e.setAttribute("aria-label","Interactive hotspot");let a=document.createElement("div");a.className="pnlm-hotspot-wrapper";let o="hotspot-tooltip-"+Math.random().toString(36).substr(2,9),n="Panorama hotspot";if(t.text){let r=document.createElement("div");r.innerHTML=t.text;let i=r.textContent||r.innerText||"";n="Panorama hotspot: "+i.trim()}else t.buttonText&&(n="Panorama hotspot: "+t.buttonText.trim());let l;if("link"===t.type&&t.link){(l=document.createElement("a")).className="pnlm-hotspot-icon";let s="";s="object"==typeof t.link?Array.isArray(t.link.url)?t.link.url[0]||"":t.link.url||"":t.link,l.href=s||"#","object"==typeof t.link&&!0===t.link.newTab&&(l.target="_blank",l.rel="noopener noreferrer"),l.setAttribute("aria-label",n),t.text&&l.setAttribute("aria-describedby",o)}else(l=document.createElement("button")).className="pnlm-hotspot-icon",l.type="button",l.setAttribute("tabindex","0"),l.setAttribute("aria-label",n),l.setAttribute("role","button"),t.text&&(l.setAttribute("aria-describedby",o),l.setAttribute("aria-expanded","false"));let c=document.createElement("span");if(c.className="pnlm-hotspot-icon-inner",c.setAttribute("aria-hidden","true"),c.innerHTML=t.customIcon,t.buttonText){let d=document.createElement("span");d.className="pnlm-hotspot-text",d.innerHTML=t.buttonText,c.appendChild(d)}if(l.appendChild(c),a.appendChild(l),t.text){let u=document.createElement("span");u.className="pnlm-hotspot-tooltip",u.id=o,u.setAttribute("role","tooltip"),u.setAttribute("aria-hidden","true"),u.innerHTML=t.text,a.appendChild(u);let p=()=>{u.setAttribute("aria-hidden","false"),"BUTTON"===l.tagName&&l.setAttribute("aria-expanded","true")},m=()=>{u.setAttribute("aria-hidden","true"),"BUTTON"===l.tagName&&l.setAttribute("aria-expanded","false")},f=()=>{let a=e.closest(".x-panorama-viewer");if(a&&a.pannellumInstance&&void 0!==t.pitch&&void 0!==t.yaw)try{let o=a.pannellumInstance;o.lookAt(t.pitch,t.yaw,void 0,1e3)}catch(n){console.warn("Could not move camera to hotspot:",n)}};l.addEventListener("mouseenter",p),l.addEventListener("mouseleave",m),l.addEventListener("focus",()=>{p(),f()}),l.addEventListener("blur",m)}e.innerHTML="",e.appendChild(a)},t=function(t,a=null,o=null){let n=[],r=null,i=t.closest(".brxe-xpanoramaviewer");if(i){let l=i.getAttribute("data-panorama-config");if(l)try{r=JSON.parse(l)}catch(s){console.warn("Error parsing main element config:",s)}}let c=t.querySelector(".x-hotspot-data");if(!c)return n;let d=c.querySelectorAll(".x-hotspot-item");return d.forEach((t,a)=>{let i=parseFloat(t.dataset.pitch)||0,l=parseFloat(t.dataset.yaw)||0,s=t.dataset.type||"info",c=t.querySelector(".x-hotspot-icon"),d=t.querySelector(".x-hotspot-text"),u=t.querySelector(".x-hotspot-button-text"),p="";p=c&&c.innerHTML.trim()?c.innerHTML:"scene"===s?'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5.205 8.5a1.875 1.875 0 1 0 3.75 0 1.875 1.875 0 1 0 -3.75 0Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M20.2 16.955 15.828 10.4a0.844 0.844 0 0 0 -1.393 -0.015L12.19 13.6l-1.39 -1.117a0.843 0.843 0 0 0 -1.229 0.191l-2.865 4.3" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M2.25 3.023a1.5 1.5 0 0 0 -1.5 1.5v14.954a1.5 1.5 0 0 0 1.5 1.5h19.5a1.5 1.5 0 0 0 1.5 -1.5v-12a1.5 1.5 0 0 0 -0.426 -1.047l-2.883 -2.955a1.5 1.5 0 0 0 -1.074 -0.452Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>':"link"===s?'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.364 15.536 16.95 14.12l1.414 -1.414a5 5 0 1 0 -7.071 -7.071L9.879 7.05 8.464 5.636 9.88 4.222a7 7 0 0 1 9.9 9.9l-1.415 1.414zm-2.828 2.828 -1.415 1.414a7 7 0 0 1 -9.9 -9.9l1.415 -1.414L7.05 9.88l-1.414 1.414a5 5 0 1 0 7.071 7.071l1.414 -1.414 1.415 1.414zm-.708 -10.607 1.415 1.415 -7.071 7.07 -1.415 -1.414 7.071 -7.07z" fill="currentColor"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="m9 23.25 -2.76 -3.11a1.55 1.55 0 1 1 2.32 -2.07l1.94 2.18v-9a1.5 1.5 0 0 1 3 0V18H15a4.49 4.49 0 0 1 4.5 4.5v0.75" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path><path d="M17.25 13.57a7.5 7.5 0 1 0 -10.5 0" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></g></svg>';let m=d?d.innerHTML:"",f=u?u.textContent:"",h={pitch:i,yaw:l,type:s,createTooltipFunc:e,createTooltipArgs:{customIcon:p,text:m,type:s,buttonText:f,pitch:i,yaw:l,config:o,mainElementConfig:r}};"link"===s&&t.dataset.link?h.createTooltipArgs.link={url:t.dataset.link,newTab:!0}:"scene"===s&&t.dataset.sceneId&&(h.sceneId=t.dataset.sceneId),n.push(h)}),n},a=function(e){bricksQuerySelectorAll(e,".brxe-xpanoramaviewer").forEach(e=>{let a=e.getAttribute("data-x-id");if("undefined"==typeof pannellum){console.error("Pannellum library not loaded");return}let o=e.querySelector(".x-panorama-viewer");if(!o){console.error("Panorama viewer wrapper not found");return}let n=document.querySelector("body > .brx-body.iframe");if("true"===o.dataset.initializing)return;if(o.pannellumInstance){if(!n)return;{try{o.pannellumInstance.getScene&&(preservedActiveScene=o.pannellumInstance.getScene())&&(o.dataset.preservedActiveScene=preservedActiveScene)}catch(r){}let i=o.querySelector("canvas");if(i){let l=i.getContext("webgl")||i.getContext("experimental-webgl");if(l){let s=l.getExtension("WEBGL_lose_context");s&&s.loseContext()}}o.pannellumInstance.destroy(),o.pannellumInstance=null;let c=o.querySelectorAll(".pnlm-ui, .pnlm-render-container");c.forEach(e=>e.remove()),o.classList.remove("pnlm-container","pnlm-grab","pnlm-grabbing"),o.removeAttribute("tabindex")}}o.dataset.initializing="true",o.xPanoramaObservers||(o.xPanoramaObservers=[]);let d=e.getAttribute("data-panorama-config");if(!d){console.error("No panorama configuration found");return}let u;try{u=JSON.parse(d)}catch(p){console.error("Invalid panorama configuration:",p);return}let m=(t,r)=>{if(!n)return;let i=`Debug-${a}`;if(window.xPanoramaObserverInstances[i]){let l=window.xPanoramaObservers.indexOf(i);l>-1&&window.xPanoramaObservers.splice(l,1),window.xPanoramaObserverInstances[i].disconnect(),delete window.xPanoramaObserverInstances[i]}let s=o.querySelector(".pnlm-debug-overlay");s&&s.remove();let c=r.hotSpotDebug||r.default&&r.default.hotSpotDebug,d=document.createElement("div");d.className="pnlm-debug-overlay",d.style.cssText="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #fff; padding: 10px 15px; border-radius: 4px; font-family: monospace; font-size: 12px; z-index: 99999; pointer-events: auto; line-height: 1.6;",d.setAttribute("data-brx-ignore","true"),d.setAttribute("data-no-bricks","true"),c||(d.style.display="none"),o.appendChild(d);let u=async(e,t)=>{try{await navigator.clipboard.writeText(e),t.style.transition="opacity 0.15s ease",t.style.opacity="0.5",setTimeout(()=>{t.style.opacity="1"},150)}catch(a){console.warn("Failed to copy to clipboard:",a)}},p=()=>{let e=t.getPitch().toFixed(2),a=t.getYaw().toFixed(2);d.innerHTML=`<strong>Current View:</strong><br>Pitch: <span class="clickable-value" data-value="${e}" data-type="Pitch" style="cursor: pointer; text-decoration: underline; color: #4CAF50;">${e}\xb0</span><br>Yaw: <span class="clickable-value" data-value="${a}" data-type="Yaw" style="cursor: pointer; text-decoration: underline; color: #4CAF50;">${a}\xb0</span>`,d.querySelectorAll(".clickable-value").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let a=e.getAttribute("data-value");u(a,e)})})};o.addEventListener("mousemove",p),p();let m=`Debug-${a}`;if(!window.xPanoramaObserverInstances[m]&&!window.xPanoramaObservers.includes(m)){window.xPanoramaObservers.push(m);let f=new MutationObserver(()=>{let t=e.getAttribute("data-panorama-config");if(t)try{let a=JSON.parse(t),o=a.hotSpotDebug||a.default&&a.default.hotSpotDebug;d.style.display=o?"":"none"}catch(n){}});f.observe(e,{attributes:!0,attributeFilter:["data-panorama-config"]}),window.xPanoramaObserverInstances[m]=f}},f=()=>{let r=o.dataset.preservedActiveScene||null;r&&delete o.dataset.preservedActiveScene;let i=Array.from(e.querySelectorAll(".brxe-xpanoramascene")),l=i.length>0;if(l){let s={},c=null;if(i.forEach((e,t)=>{let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a),n=o.sceneId||e.getAttribute("data-x-id")||"scene-"+Math.random().toString(36).substr(2,9);o.sceneId=n,s[n]=o,e.setAttribute("data-panorama-config",JSON.stringify(o)),0===t&&(c=n),e.style.display="none"}catch(r){console.error("Invalid scene config:",r)}}),n&&r&&s[r]&&(c=r),Object.keys(s).length>0&&c){let d=u.hotSpotDebug,p=u.yaw,f=u.pitch,h=u.hfov,$=u.autoRotate;u={default:{firstScene:c,sceneFadeDuration:1e3,autoLoad:!0,showZoomCtrl:void 0===u.showZoomCtrl||u.showZoomCtrl,showFullscreenCtrl:void 0===u.showFullscreenCtrl||u.showFullscreenCtrl,mouseZoom:void 0===u.mouseZoom||u.mouseZoom,mouseZoomSensitivity:void 0!==u.mouseZoomSensitivity?parseFloat(u.mouseZoomSensitivity):1,friction:void 0!==u.friction?parseFloat(u.friction):.5,draggable:void 0===u.draggable||u.draggable,disableKeyboardCtrl:void 0!==u.disableKeyboardCtrl&&u.disableKeyboardCtrl,hotSpotDebug:void 0!==d&&d,autoRotate:void 0!==$?parseFloat($):void 0},scenes:s},Object.keys(s).forEach(e=>{let t=s[e];t&&(void 0===t.yaw&&void 0!==p&&(t.yaw=parseFloat(p)),void 0===t.pitch&&void 0!==f&&(t.pitch=parseFloat(f)),void 0===t.hfov&&void 0!==h&&(t.hfov=parseFloat(h)),void 0===t.autoRotate&&void 0!==$&&(t.autoRotate=parseFloat($)))})}}if(u.scenes&&i.forEach(e=>{let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a),n=o.sceneId;if(!n||!u.scenes[n])return;let r=t(e,n,u);r.length>0&&(u.scenes[n].hotSpots||(u.scenes[n].hotSpots=[]),u.scenes[n].hotSpots=u.scenes[n].hotSpots.concat(r));let i=e.querySelectorAll(".brxe-xpanoramahotspot");i.forEach((e,t)=>{let a=e.getAttribute("data-hotspot-config"),o={pitch:0,yaw:0,type:"info"};if(a)try{o={...o,...JSON.parse(a)}}catch(r){console.error("Invalid hotspot config:",r)}let i=e.id||`hotspot-${n}-${t}`;e.id||(e.id=i),u.scenes[n].hotSpots||(u.scenes[n].hotSpots=[]);let l=u.scenes[n].hotSpots.find(e=>e.createTooltipArgs===`#${i}`);if(l)return;let s={pitch:o.pitch,yaw:o.yaw,type:o.type,createTooltipFunc(e,t){e.style.backgroundImage="none",e.style.width="auto",e.style.height="auto";let a=document.createElement("div");a.className="pnlm-hotspot-wrapper";let n=document.createElement("button");n.className="pnlm-hotspot-icon",n.type="button";let r=document.createElement("span");r.className="pnlm-hotspot-icon-inner",o.customIcon?r.innerHTML=o.customIcon:r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 26 26"><circle fill-opacity=".78" cy="13" cx="13" r="11" fill="currentColor"/></svg>',n.appendChild(r),a.appendChild(n);let i=document.querySelector(t);if(i){e.classList.add("pnlm-tooltip");let l=document.createElement("span");for(l.className="pnlm-hotspot-tooltip";i.firstChild;)l.appendChild(i.firstChild);a.appendChild(l)}e.innerHTML="",e.appendChild(a)},createTooltipArgs:`#${i}`};o.cssClass&&(s.cssClass=o.cssClass),u.scenes[n].hotSpots.push(s)})}catch(l){console.error("Error processing scene hotspots:",l)}}),!l){let v=t(e,null,u);v.length>0&&(u.hotSpots||(u.hotSpots=[]),u.hotSpots=u.hotSpots.concat(v))}if(u.compass=!1,n&&a)try{if(l){let g=e.querySelector(".brxe-xpanoramascene.is-active-element");if(g){let b=JSON.parse(g.getAttribute("data-panorama-config")),y=b.sceneId,_=localStorage.getItem(`panorama_view_${a}_${y}`);if(_){let w=JSON.parse(_),x=Date.now()-w.timestamp;x<3e5&&u.scenes&&u.scenes[y]&&(u.scenes[y].yaw=w.yaw,u.scenes[y].pitch=w.pitch,u.scenes[y].hfov=w.hfov)}}}else{let S=localStorage.getItem(`panorama_view_${a}_default`);if(S){let k=JSON.parse(S),I=Date.now()-k.timestamp;I<3e5&&(u.yaw=k.yaw,u.pitch=k.pitch,u.hfov=k.hfov)}}}catch(A){console.warn("Could not restore saved view state in main init:",A)}let C=e.getAttribute("data-panorama-config"),E={};if(C)try{E=JSON.parse(C)}catch(P){console.warn("Could not parse original config:",P)}let L=null;if(E.showScrollInstructions){(L=document.createElement("div")).className="pnlm-scroll-instructions",L.style.opacity="0",L.style.pointerEvents="none";let T=/Mac|iPhone|iPad|iPod/.test(navigator.userAgent),q=E.scrollInstructionsDesktopText||"Use {x_key} + scroll to zoom";q=q.replace("{x_key}",T?"âŒ˜":"Ctrl"),L.innerHTML=q,o.appendChild(L)}let Z=n&&"true"===e.getAttribute("data-preview-spinner");Z?o.setAttribute("data-loading","true"):n||o.setAttribute("data-loading","true");try{let O=pannellum.viewer(o,u);if(o.pannellumInstance=O,Z||(O.on("load",()=>{setTimeout(()=>{o.setAttribute("data-loading","false")},0)}),O.on("error",()=>{setTimeout(()=>{o.setAttribute("data-loading","false")},0)})),L){let M=()=>{L&&(L.style.opacity="0")},F=!1;O.on("mousedown",()=>{F=!1}),o.addEventListener("mousemove",e=>{1!==e.buttons||F||(F=!0,M())}),o.addEventListener("touchmove",e=>{e.touches.length>=2&&M()})}let H=O.isOrientationSupported();if(H){let D=()=>{let t=setTimeout(()=>{window.removeEventListener("deviceorientation",a)},500),a=o=>{clearTimeout(t),window.removeEventListener("deviceorientation",a),(null!==o.alpha||null!==o.beta||null!==o.gamma)&&e.setAttribute("data-orientation-supported","true")};window.addEventListener("deviceorientation",a)};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?(DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&D()}).catch(()=>{}),o.addEventListener("click",async()=>{try{let e=await DeviceOrientationEvent.requestPermission();"granted"===e&&D()}catch(t){}},{once:!0})):D()}if(setTimeout(()=>{let e=o.querySelector(".pnlm-zoom-in"),t=o.querySelector(".pnlm-zoom-out");e&&e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();let t=O.getHfov(),a=O.getHfovBounds(),o=Math.max(t-10,a[0]);O.setHfov(o,300)},!0),t&&t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();let t=O.getHfov(),a=O.getHfovBounds(),o=Math.min(t+10,a[1]);O.setHfov(o,300)},!0)},0),o.dataset.initializing="false",O.on("load",()=>{n||e.setAttribute("data-panorama-loaded","true")}),n&&a){let N=!1;O.on("load",()=>{setTimeout(()=>{N=!0},1e3)}),O.on("animatefinished",()=>{if(N)try{let e=null;if(e=l?O.getScene():"default"){let t={yaw:O.getYaw(),pitch:O.getPitch(),hfov:O.getHfov(),timestamp:Date.now()};localStorage.setItem(`panorama_view_${a}_${e}`,JSON.stringify(t))}}catch(o){console.warn("Could not save view state from main instance:",o)}})}if(l){let z=u.default?u.default.firstScene:Object.keys(u.scenes)[0],R=[z];O.on("scenechange",e=>{o.setAttribute("data-loading","true"),R[R.length-1]!==e&&(R.push(e),R.length>50&&(R=R.slice(-25)),updateBackButton())}),O.on("scenechangefadedone",()=>{setTimeout(()=>{o.setAttribute("data-loading","false")},300)}),setTimeout(()=>{let e=o.querySelector(".pnlm-controls-container");if(e){let t=document.createElement("div");t.className="pnlm-back-button pnlm-sprite pnlm-controls pnlm-control x-panorama-back-btn",t.setAttribute("role","button"),t.setAttribute("aria-label","Go back to previous scene"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',t.style.display="none",e.appendChild(t),t.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),R.length>1){R.pop();let t=R[R.length-1];O.loadScene(t),a()}});let a=()=>{t.style.display=R.length>1?"":"none"};window.updateBackButton=a}},100)}if(n&&l){let B=`Main-${a}`;if(window.xPanoramaObserverInstances[B]){window.xPanoramaObserverInstances[B].disconnect(),delete window.xPanoramaObserverInstances[B];let K=window.xPanoramaObservers.indexOf(B);K>-1&&window.xPanoramaObservers.splice(K,1)}let j=null,V=null,Y=`Main-${a}`;window.xPanoramaObservers.push(Y);let U=new MutationObserver(r=>{r.forEach(r=>{let l=r.target;if("attributes"===r.type&&"class"===r.attributeName){let s=l.classList.contains("is-active-element"),c=r.oldValue&&r.oldValue.includes("is-active-element");if(l.classList.contains("brxe-xpanoramascene")&&s&&!c&&l!==j){j=l;let d=l.getAttribute("data-panorama-config");if(d)try{let u=JSON.parse(d),p=u.sceneId;p&&(n&&(o.dataset.preservedActiveScene=p),V&&clearTimeout(V),V=setTimeout(()=>{let n=o.querySelector("canvas");if(n){let r=n.getContext("webgl")||n.getContext("experimental-webgl");if(r){let l=r.getExtension("WEBGL_lose_context");l&&l.loseContext()}}O.destroy();let s={};i.forEach((e,t)=>{let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a);o.sceneId&&(s[o.sceneId]=o)}catch(n){}});let c=e.getAttribute("data-panorama-config"),d=c?JSON.parse(c):{};Object.keys(s).forEach(e=>{});let u={default:{firstScene:p,sceneFadeDuration:1e3,autoLoad:!0,showZoomCtrl:void 0===d.showZoomCtrl||d.showZoomCtrl,showFullscreenCtrl:void 0===d.showFullscreenCtrl||d.showFullscreenCtrl,mouseZoom:void 0===d.mouseZoom||d.mouseZoom,mouseZoomSensitivity:void 0!==d.mouseZoomSensitivity?parseFloat(d.mouseZoomSensitivity):1,friction:void 0!==d.friction?parseFloat(d.friction):.5,draggable:void 0===d.draggable||d.draggable,disableKeyboardCtrl:void 0!==d.disableKeyboardCtrl&&d.disableKeyboardCtrl,hotSpotDebug:void 0!==d.hotSpotDebug&&d.hotSpotDebug,autoRotate:void 0!==d.autoRotate?parseFloat(d.autoRotate):void 0},scenes:s};if(i.forEach(e=>{let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a),n=o.sceneId;if(!n||!s[n])return;let r=t(e,n,u);r.length>0&&(s[n].hotSpots||(s[n].hotSpots=[]),s[n].hotSpots=s[n].hotSpots.concat(r))}catch(i){console.error("Error processing scene hotspots in mutation observer:",i)}}),Object.keys(s).forEach(e=>{let t=s[e];t&&(void 0===t.yaw&&void 0!==d.yaw&&(t.yaw=parseFloat(d.yaw)),void 0===t.pitch&&void 0!==d.pitch&&(t.pitch=parseFloat(d.pitch)),void 0===t.hfov&&void 0!==d.hfov&&(t.hfov=parseFloat(d.hfov)),void 0===t.autoRotate&&void 0!==d.autoRotate&&(t.autoRotate=parseFloat(d.autoRotate)))}),a&&p)try{let f=localStorage.getItem(`panorama_view_${a}_${p}`);if(f){let h=JSON.parse(f);Date.now()-h.timestamp<3e5&&u.scenes&&u.scenes[p]&&(u.scenes[p].yaw=h.yaw,u.scenes[p].pitch=h.pitch,u.scenes[p].hfov=h.hfov)}}catch($){console.warn("Could not inject saved view state:",$)}let v=pannellum.viewer(o,u);if(o.pannellumInstance=v,a){let g=!1;v.on("load",()=>{setTimeout(()=>{g=!0},1e3)}),v.on("animatefinished",()=>{if(g)try{let e=null;if(e=u.scenes?v.getScene():"default"){let t={yaw:v.getYaw(),pitch:v.getPitch(),hfov:v.getHfov(),timestamp:Date.now()};localStorage.setItem(`panorama_view_${a}_${e}`,JSON.stringify(t))}}catch(o){console.warn("Could not save view state:",o)}})}v.on("load",()=>{e.setAttribute("data-panorama-loaded","true")}),window.xPanorama||(window.xPanorama={}),window.xPanorama.Instances||(window.xPanorama.Instances={}),a&&(window.xPanorama.Instances[a]=v),m(v,u)},150))}catch(f){console.error("Error loading scene:",f)}}}else if("attributes"===r.type&&"data-panorama-config"===r.attributeName){JSON.parse(l.getAttribute("data-panorama-config"));let h=e.querySelector(".brxe-xpanoramascene.is-active-element");if(h&&JSON.parse(h.getAttribute("data-panorama-config")),j){let $=l.getAttribute("data-panorama-config");$&&(V&&clearTimeout(V),V=setTimeout(()=>{try{let n=e.querySelector(".brxe-xpanoramascene.is-active-element");if(!n)return;let r=n.getAttribute("data-panorama-config"),i=JSON.parse(r),l=i.sceneId;if(l){O.destroy();let s={},c=e.querySelectorAll(".brxe-xpanoramascene");c.forEach((e,t)=>{let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a);o.sceneId&&(s[o.sceneId]=o)}catch(n){}});let d=e.getAttribute("data-panorama-config"),u=d?JSON.parse(d):{},p={default:{firstScene:l,sceneFadeDuration:1e3,autoLoad:void 0===u.autoLoad||u.autoLoad,showZoomCtrl:void 0===u.showZoomCtrl||u.showZoomCtrl,showFullscreenCtrl:void 0===u.showFullscreenCtrl||u.showFullscreenCtrl,mouseZoom:void 0===u.mouseZoom||u.mouseZoom,mouseZoomSensitivity:void 0!==u.mouseZoomSensitivity?parseFloat(u.mouseZoomSensitivity):1,friction:void 0!==u.friction?parseFloat(u.friction):.5,draggable:void 0===u.draggable||u.draggable,disableKeyboardCtrl:void 0!==u.disableKeyboardCtrl&&u.disableKeyboardCtrl,hotSpotDebug:void 0!==u.hotSpotDebug&&u.hotSpotDebug,autoRotate:void 0!==u.autoRotate?parseFloat(u.autoRotate):void 0},scenes:s};if(c.forEach(e=>{if(!e.classList.contains("is-active-element"))return;let a=e.getAttribute("data-panorama-config");if(a)try{let o=JSON.parse(a),n=o.sceneId;if(!n||!s[n])return;let r=t(e,n,p);r.length>0&&(s[n].hotSpots||(s[n].hotSpots=[]),s[n].hotSpots=s[n].hotSpots.concat(r))}catch(i){console.error("Error processing scene hotspots in mutation observer 2:",i)}}),Object.keys(s).forEach(e=>{let t=s[e];t&&(void 0===t.yaw&&void 0!==u.yaw&&(t.yaw=parseFloat(u.yaw)),void 0===t.pitch&&void 0!==u.pitch&&(t.pitch=parseFloat(u.pitch)),void 0===t.hfov&&void 0!==u.hfov&&(t.hfov=parseFloat(u.hfov)),void 0===t.autoRotate&&void 0!==u.autoRotate&&(t.autoRotate=parseFloat(u.autoRotate)))}),a&&l)try{let f=localStorage.getItem(`panorama_view_${a}_${l}`);if(f){let h=JSON.parse(f),$=Date.now()-h.timestamp;$<3e5&&p.scenes&&p.scenes[l]&&(p.scenes[l].yaw=h.yaw,p.scenes[l].pitch=h.pitch,p.scenes[l].hfov=h.hfov)}}catch(v){console.warn("Could not inject saved view state:",v)}let g=pannellum.viewer(o,p);if(o.pannellumInstance=g,a){let b=!1;g.on("load",()=>{setTimeout(()=>{b=!0},1e3)}),g.on("animatefinished",()=>{if(b)try{let e=null;if(e=p.scenes?g.getScene():"default"){let t={yaw:g.getYaw(),pitch:g.getPitch(),hfov:g.getHfov(),timestamp:Date.now()};localStorage.setItem(`panorama_view_${a}_${e}`,JSON.stringify(t))}}catch(o){console.warn("Could not save view state:",o)}})}g.on("load",()=>{e.setAttribute("data-panorama-loaded","true")}),window.xPanorama||(window.xPanorama={}),window.xPanorama.Instances||(window.xPanorama.Instances={}),a&&(window.xPanorama.Instances[a]=g),m(g,p)}}catch(y){console.error("Error reloading scene:",y)}},0))}}})});i.forEach(e=>{U.observe(e,{attributes:!0,attributeFilter:["class","data-panorama-config"],attributeOldValue:!0})}),window.xPanoramaObserverInstances[B]=U}m(O,u),o.addEventListener("keydown",function(e){"Shift"===e.key&&e.stopPropagation()},!0);let G=!1!==u.mouseZoom,W=null;if(G){o.addEventListener("wheel",t=>{let a=document.fullscreenElement||document.webkitFullscreenElement||e.hasAttribute("data-x-fullscreen-fallback-active");!a&&(t.metaKey||t.ctrlKey?L&&(L.style.opacity="0",W&&(clearTimeout(W),W=null)):(t.stopPropagation(),L&&(L.style.opacity="1",W&&clearTimeout(W),W=setTimeout(()=>{L&&(L.style.opacity="0"),W=null},500))))},{capture:!0});let J=0;o.addEventListener("touchstart",e=>{J=e.touches.length},{capture:!0}),o.addEventListener("touchmove",t=>{let a=document.fullscreenElement||document.webkitFullscreenElement||e.hasAttribute("data-x-fullscreen-fallback-active");if(1!==t.touches.length||1!==J||a)t.touches.length>=2&&!a&&L&&(L.style.opacity="0",W&&(clearTimeout(W),W=null));else if(t.stopPropagation(),L){let o=E.scrollInstructionsMobileText||"Use two fingers to navigate";L.innerHTML=o,L.style.opacity="1",W&&clearTimeout(W),W=setTimeout(()=>{L&&(L.style.opacity="0"),W=null},500)}},{capture:!0}),o.addEventListener("touchend",e=>{J=e.touches.length},{capture:!0})}let Q=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,X=!1!==u.fullscreenFallback,ee=u.default?u.default.showFullscreenCtrl:u.showFullscreenCtrl;if(Q&&X&&!1!==ee){let et=0;!1!==ee&&setTimeout(()=>{let t=o.querySelector(".pnlm-fullscreen-toggle-button");if(!t){let a=o.querySelector(".pnlm-controls-container");a&&((t=document.createElement("div")).className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control x-panorama-fullscreen-btn",t.setAttribute("role","button"),t.setAttribute("aria-label","Toggle fullscreen"),a.appendChild(t))}t&&t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),e.hasAttribute("data-x-fullscreen-fallback-active")?function t(){document.body.style.position="",document.body.style.top="",document.body.style.width="",e.removeAttribute("data-x-fullscreen-fallback-active"),e.dispatchEvent(new Event("x_panorama_fullscreen_inactive")),window.scrollTo({top:et,behavior:"instant"});let a=o.querySelector(".pnlm-fullscreen-toggle-button, .x-panorama-fullscreen-btn");a&&(a.classList.remove("pnlm-fullscreen-toggle-button-active"),a.classList.add("pnlm-fullscreen-toggle-button-inactive")),setTimeout(()=>{o.pannellumInstance&&o.pannellumInstance.resize&&o.pannellumInstance.resize()},0)}():function t(){et=window.scrollY,document.body.style.position="fixed",document.body.style.top="-"+et+"px",document.body.style.width="100%",e.setAttribute("data-x-fullscreen-fallback-active",""),e.dispatchEvent(new Event("x_panorama_fullscreen_active"));let a=o.querySelector(".pnlm-fullscreen-toggle-button, .x-panorama-fullscreen-btn");a&&(a.classList.remove("pnlm-fullscreen-toggle-button-inactive"),a.classList.add("pnlm-fullscreen-toggle-button-active")),setTimeout(()=>{o.pannellumInstance&&o.pannellumInstance.resize&&o.pannellumInstance.resize()},0)}()})},100)}o.pannellumInstance=O,window.xPanorama||(window.xPanorama={}),window.xPanorama.Instances||(window.xPanorama.Instances={}),a&&(window.xPanorama.Instances[a]=O)}catch(ea){console.error("Error initializing panorama viewer:",ea)}},h=u.loadingStrategy||"eager";if(e.xPanoramaInit=f,n)setTimeout(f,100);else if("interactions"===h){let $=u.placeholderImage;$&&(o.style.backgroundImage=`url(${$})`,o.style.backgroundSize="cover",o.style.backgroundPosition="center");return}else if("lazy"===h){let v=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(f(),v.unobserve(e))})},{rootMargin:"50px"});v.observe(e)}else if("click"===h){let g=u.placeholderImage;g&&(o.style.backgroundImage=`url(${g})`,o.style.backgroundSize="cover",o.style.backgroundPosition="center");let b=e.querySelector(".x-panorama-viewer_inner");if(b){let y=e=>{b.removeEventListener("click",y),o.style.backgroundImage="",f()};b.addEventListener("click",y)}return}else f()})};a(document),xExtrasRegisterAJAXHandler("doExtrasPanoramaViewer"),window.doExtrasPanoramaViewer=a,window.xPanoramaInit=function(e){if(!e)return!1;let t=e;return t.classList.contains("brxe-xpanoramaviewer")||(t=e.closest(".brxe-xpanoramaviewer")),!!t&&"function"==typeof t.xPanoramaInit&&(t.xPanoramaInit(),!0)},"undefined"==typeof bricksextras&&(window.bricksextras={}),bricksextras.panorama={load(e){let t=e?.target||!1;return!!t&&window.xPanoramaInit(t)}}}document.addEventListener("DOMContentLoaded",function(e){bricksIsFrontend&&xPanoramaViewer()});